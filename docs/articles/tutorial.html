<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tutorial for LBCNet pacakge • LBCNet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="tutorial_files/libs/quarto-html/popper.min.js"></script><script src="tutorial_files/libs/quarto-html/tippy.umd.min.js"></script><link href="tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="tutorial_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial for LBCNet pacakge">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">LBCNet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Tutorial for LBCNet pacakge</h1>





      <div class="d-none name"><code></code></div>
    </div>






    <section class="level2"><h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Welcome to the <code>LBCNet</code> tutorial! This guide provides a detailed introduction to the <code>LBCNet</code> package and demonstrates its use in causal inference analyses. LBC-Net stands for Local Balance with Calibration implemented by Neural Networks. The package offers a set of tools for estimating propensity scores in a nonparametric and flexible manner using deep neural networks, along with comprehensive diagnostics and visualization utilities.</p>
<p><code>LBCNet</code> has several key objectives. First, it provides accurate propensity score estimation to support causal effect estimation, including the average treatment effect (ATE) and the average treatment effect on the treated (ATT). Second, it offers diagnostic tools to assess the quality of the estimated propensity scores, such as evaluations of covariate balance, propensity score distributions, and checks for local balance and local calibration. Third, LBCNet includes tools for variance estimation through plug-in influence-function methods, enabling uncertainty quantification for both point estimates and weighted estimators. Finally, the package now supports survival outcome estimands, including IPW-adjusted survival differences and risk differences at a fixed time ( t ), extending LBC-Net’s framework to time-to-event analyses.</p>
<p>Propensity score methods have become a cornerstone for addressing confounding in observational studies. The concept of the propensity score—defined as the probability of treatment assignment conditional on observed covariates—was introduced by Rosenbaum and Rubin (1983). Under the strong ignorability assumption, adjusting for the propensity score allows unbiased estimation of causal effects. A key feature is the balancing property: given the propensity score, the distribution of covariates should be similar between treatment groups. Achieving good covariate balance is essential for reducing bias.</p>
<p>LBC-Net directly targets covariate balance through two theoretical principles: local balance, which enforces covariate balance across a dense grid of balancing scores, and local calibration, which ensures that balancing scores correspond to the true propensity scores. Neural networks are used to optimize these conditions due to their flexibility in modeling complex, nonlinear, and high-dimensional relationships.</p>
<p>This tutorial walks you through the process of setting up <code>LBCNet</code>, including configuration of Python environments via <code>reticulate</code>, and demonstrates a complete analysis using the public <code>lalonde</code> dataset from the <code>sbw</code> package (Zubizarreta, 2024). We cover how to choose model parameters, interpret diagnostic plots, evaluate balance, and compute treatment effects. Examples for variance estimation and survival-based estimands are also highlighted. Practical notes and recommended workflows are included to help users apply LBC-Net effectively in real-world applications.</p>
<p>Support for multiple treatment groups is currently under development and will be included in a future release of the package.</p>
</section><section class="level2"><h2 id="setup-configuring-python-for-lbcnet">Setup: Configuring Python for LBCNet<a class="anchor" aria-label="anchor" href="#setup-configuring-python-for-lbcnet"></a>
</h2>
<p>Before using <code>LBCNet</code>, you need to configure a Python environment. This environment runs the neural network model behind LBC-Net’s nonparametric propensity score estimation. The package uses the <code>reticulate</code> package to manage Python environments and packages from within R. The key function for managing this setup is <code><a href="../reference/setup_lbcnet.html">setup_lbcnet()</a></code>.</p>
<p><code><a href="../reference/setup_lbcnet.html">setup_lbcnet()</a></code> configures the Python environment required by <code>LBCNet</code>. It checks for Python availability, ensures necessary Python packages (e.g., Torch) are installed, and manages virtual environments. You can call <code><a href="../reference/setup_lbcnet.html">setup_lbcnet()</a></code> directly before running <code><a href="../reference/lbc_net.html">lbc_net()</a></code>, or let <code><a href="../reference/lbc_net.html">lbc_net()</a></code> call it automatically during model fitting by passing arguments through <code>setup_lbcnet_args</code>.</p>
<p><strong>How it works:</strong></p>
<ul>
<li>If Python has not been configured, <code><a href="../reference/setup_lbcnet.html">setup_lbcnet()</a></code> will Automatically create a virtual environment named “r-lbcnet” by default (if <code>create_if_missing = TRUE</code>). And install the required Python packages.</li>
<li>If you already have a virtual environment or want to use system Python, you can customize how <code>LBCNet</code> connects to Python.</li>
</ul>
<section class="level3"><h3 id="option-1-virtual-environment-recommended">Option 1: Virtual Environment (Recommended)<a class="anchor" aria-label="anchor" href="#option-1-virtual-environment-recommended"></a>
</h3>
<p>This is the default and safest setup, creating a dedicated Python environment for <code>LBCNet</code>. If you have not set up <code>reticulate</code> before, simply run:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">LBCNet</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Automatically creates and sets up "r-lbcnet" virtual environment</span></span>
<span><span class="fu"><a href="../reference/setup_lbcnet.html">setup_lbcnet</a></span><span class="op">(</span>create_if_missing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>This will create a virtual environment named “r-lbcnet” if it doesn’t exist and install all necessary Python packages (TensorFlow, etc.). Then it activates and uses the virtual environment.</p>
<p>If you want to manually create and control the virtual environment, you can do:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the virtual environment (only run once)</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/virtualenv-tools.html" class="external-link">virtualenv_create</a></span><span class="op">(</span><span class="st">"r-lbcnet"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Activate the virtual environment in your R session</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_virtualenv</a></span><span class="op">(</span><span class="st">"r-lbcnet"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Once this is done, <code><a href="../reference/lbc_net.html">lbc_net()</a></code> will automatically detect and use the environment “r-lbcnet”. If you have multiple virtual environments, specify the environment explicitly via <code>setup_lbcnet(envname = "r-lbcnet")</code>. In addition, you can also pass the environment name when calling <code><a href="../reference/lbc_net.html">lbc_net()</a></code> by using the <code>setup_lbcnet_args</code> argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lbc_net.html">lbc_net</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mydata</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">Tr</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>,</span>
<span>  setup_lbcnet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>envname <span class="op">=</span> <span class="st">"r-lbcnet"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="option-2-system-python">Option 2: System Python<a class="anchor" aria-label="anchor" href="#option-2-system-python"></a>
</h3>
<p>If you prefer to use an existing system Python installation instead of virtualenv or Conda, you can specify <code>use_system_python = TRUE</code> and point to your Python executable. You can use the following code to find the available Python executables on your system:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">LBCNet</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Discover available Python environments</span></span>
<span><span class="va">available_pythons</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"python"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which</a></span><span class="op">(</span><span class="st">"python3"</span><span class="op">)</span>,</span>
<span>  <span class="fu">reticulate</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/py_discover_config.html" class="external-link">py_discover_config</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">python</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean up and display results</span></span>
<span><span class="va">available_pythons</span> <span class="op">&lt;-</span> <span class="va">available_pythons</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nzchar</a></span><span class="op">(</span><span class="va">available_pythons</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">available_pythons</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Note: <code><a href="https://rdrr.io/r/base/Sys.which.html" class="external-link">Sys.which()</a></code> returns only the first Python executable found on your system. If this does not match the Python path you want to use, you should specify the correct path manually. If you have a specific Python executable path you want to use, do this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"C:/Users/mpeng1/AppData/Local/Programs/Python/Python311/python.exe"</span> <span class="co">## change it to your path</span></span>
<span></span>
<span><span class="co"># Set up LBCNet to use system Python</span></span>
<span><span class="fu"><a href="../reference/setup_lbcnet.html">setup_lbcnet</a></span><span class="op">(</span>use_system_python <span class="op">=</span> <span class="cn">TRUE</span>, system_python_path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Alternatively, you can specify it when calling <code><a href="../reference/lbc_net.html">lbc_net()</a></code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/lbc_net.html">lbc_net</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">mydata</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">Tr</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">Y</span>,</span>
<span>  setup_lbcnet_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    use_system_python <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    system_python_path <span class="op">=</span> <span class="st">"C:/Users/mpeng1/AppData/Local/Programs/Python/Python311/python.exe"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="option-3-conda-environment">Option 3: Conda Environment<a class="anchor" aria-label="anchor" href="#option-3-conda-environment"></a>
</h3>
<p>If you prefer Conda environments, you can specify use_conda = TRUE in <code><a href="../reference/setup_lbcnet.html">setup_lbcnet()</a></code> and <code><a href="../reference/lbc_net.html">lbc_net()</a></code> to manage environments through Conda instead of virtualenv. For more details on Conda environments in R, refer to the official <a href="https://rstudio.github.io/reticulate/" class="external-link">Reticulate Documentation</a>.</p>
<p>If you encounter issues, try <code><a href="https://rstudio.github.io/reticulate/reference/py_discover_config.html" class="external-link">reticulate::py_discover_config()</a></code> to see which Python environment is active.</p>
</section></section><section class="level2"><h2 id="implementing-lbc-net-on-the-lalonde-dataset-ate-estimation">Implementing LBC-Net on the <code>lalonde</code> Dataset (ATE Estimation)<a class="anchor" aria-label="anchor" href="#implementing-lbc-net-on-the-lalonde-dataset-ate-estimation"></a>
</h2>
<p>The dataset originates from the National Supported Work (NSW) Demonstration, an experimental program designed to evaluate the impact of employment training on future earnings. The treatment assignment indicator (treatment) specifies whether an individual received the job training (1 = treated, 0 = control). The dataset includes pre-treatment covariates: age (in years), education (years of schooling), black (1 if Black, 0 otherwise), hispanic (1 if Hispanic, 0 otherwise), married (1 if married, 0 otherwise), nodegree (1 if the individual has no high school diploma), re74 (real earnings in 1974), and re75 (real earnings in 1975). The outcome variable is re78, which records real earnings in 1978. The Lalonde dataset includes 614 observations, consisting of 185 treated and 429 control subjects, with a total of 10 variables.</p>
<p>In this example, we use the <code><a href="../reference/lbc_net.html">lbc_net()</a></code> function to estimate propensity scores for the binary treatment based on the pre-treatment covariates listed above. We run <code><a href="../reference/lbc_net.html">lbc_net()</a></code> with its default parameters and provide an explanation of key options that users may want to modify depending on their analysis.</p>
<p>First, we fit the LBC-Net model to estimate the propensity score for receiving abciximab treatment. We use the covariates as predictors in the formula.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">sbw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">LBCNet</span><span class="op">)</span></span>
<span><span class="va">lbc_net.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbc_net.html">lbc_net</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">treatment</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span> <span class="va">hispanic</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>  Y <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">re78</span>,</span>
<span>  estimand <span class="op">=</span> <span class="st">"ATE"</span>,</span>
<span>  max_epochs <span class="op">=</span> <span class="fl">15000</span>,</span>
<span>  rho <span class="op">=</span> <span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>⚠️ Stopping criterion not met at max epochs. Try increasing `max_epochs` or adjusting `lsd_threshold` for better convergence.
Starting post-processing: computing treatment effect and variance...
✅ LBC-Net training completed successfully.</code></pre>
</div>
</div>
<p>Here, we adjust the <code><a href="../reference/lbc_net.html">lbc_net()</a></code> parameters to account for the small sample size and limited overlap observed in the Lalonde dataset. The mirror histogram from mirror_hist() shows poor overlap between treated and control groups, making balance harder to achieve. To address this, we increase the training iterations to 15,000 epochs (max_epochs = 15000) and expand the local neighborhood size to 40% of the sample (rho = 0.4). These adjustments give the model more time to optimize and ensure sufficient data points within each local region to improve balance.</p>
<p>The choice of rho is important and can affect the model’s ability to achieve good local balance and global balance. Typically, rho can be selected from a range of 0.1 to 0.5, depending on the sample size and the degree of overlap between treatment groups:</p>
<ul>
<li>A smaller rho (e.g., 0.1–0.2) may work well with larger samples and good overlap.</li>
<li>A larger rho (e.g., 0.3–0.5) is recommended when sample size is small or when overlap is limited, as it ensures enough observations in each local neighborhood for effective balancing. In practice, the optimal rho can be chosen by evaluating the model’s loss function and the mean global standardized difference (GSD). A lower balance loss and a smaller mean GSD typically indicate better covariate balance and improved model performance.</li>
</ul>
<p>After fitting the LBC-Net model using <code><a href="../reference/lbc_net.html">lbc_net()</a></code>, the next step is to evaluate its performance and the quality of the estimated propensity scores.</p>
<p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> function provides a quick summary of the training process, including the training loss, local balance metrics, and other key indicators. For detailed results, such as causal effect estimates and covariate balance summaries, use the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function.</p>
<p>In this example, we use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to display the results from the fitted LBC-Net model. The causal effect (ATE or ATT) is already computed during the model fitting step, so <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> does not re-estimate the causal effect; instead, it reports the values stored in the fitted object along with diagnostic summaries. If the outcome variable is not included directly in the model formula, you may specify it explicitly through the argument <code>Y</code> when fitting the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lbc_net.fit</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
 treatment ~ age + education + black + hispanic + married + nodegree +      re74 + re75
Sample Size: 614  | Number of Covariates: 8
Treated: 185  | Control: 429

--- Losses ---
Total Loss: 808.4491

--- Local Balance (LSD) % ---
Max LSD:   6.5109
Mean LSD:  2.8801

--- Global Standardized Differences (GSD) % ---
Covariate        Pre-GSD     Post-GSD
---------------------------------------
age             -22.5450      -4.5855
education         4.2090       4.4651
black           163.8478       5.9168
hispanic        -25.8951      -1.5541
married         -68.8767      -1.2885
nodegree         23.2018      -2.7438
re74            -56.2210      -1.3585
re75            -28.6199      -0.4137

--- Treatment Effect Estimate ---
ATE: -89.0508  (SE: 1088.5337)  95% CI: [-2222.5768, 2044.4752]</code></pre>
</div>
</div>
<p>For binary or continuous outcomes, the ATE or ATT reported in the summary is based on the inverse probability of treatment weights (IPTW) derived from the estimated propensity scores. For time-to-event outcomes, users should instead apply either (a) the dedicated survival method provided by <code><a href="../reference/lbc_net_surv.html">lbc_net_surv()</a></code>, or a weighted Cox proportional hazards model using the estimated weights, e.g.: <code>coxph(Surv(time, event) ~ abcix, data = lindner, weights = lbc_net.fit$weights)</code>.</p>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> output also includes a covariate balance table, which reports the standardized mean differences before and after weighting, and a global balance metric, the Global Standardized Difference (GSD). The GSD summarizes the overall covariate imbalance across all variables, expressed as a percentage. You can extract these tables from the summary output using <code>summary_out$balance_table</code> (a data frame) and <code>summary_out$gsd</code>.</p>
<p>To evaluate the performance of LBC-Net relative to traditional methods, we can compare its global balance (GSD) with that obtained from logistic regression propensity scores.</p>
<p>Here is another example illustrating how to analyze survival outcomes using <code><a href="../reference/lbc_net_surv.html">lbc_net_surv()</a></code> with the well-known Primary Biliary Cirrhosis (PBC) dataset from the <code>survival</code> package. This study followed 418 patients enrolled in a randomized clinical trial evaluating the effect of the drug D-penicillamine on survival in primary biliary cirrhosis. The dataset contains patient survival time, event status, treatment assignment, and a number of important prognostic covariates such as age, bilirubin level, albumin, and prothrombin time.</p>
<p>For demonstration, we define the treatment indicator as <code>Tr = 1</code> for the active treatment arm and <code>Tr = 0</code> for placebo, and we estimate the survival difference at the median survival time (the default in <code><a href="../reference/lbc_net_surv.html">lbc_net_surv()</a></code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">pbc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">pbc</span><span class="op">)</span></span>
<span><span class="va">pbc</span><span class="op">$</span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pbc</span><span class="op">$</span><span class="va">trt</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">pbc</span><span class="op">$</span><span class="va">status</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pbc</span><span class="op">$</span><span class="va">status</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fit_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbc_net_surv.html">lbc_net_surv</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">pbc</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">.</span><span class="op">-</span><span class="va">time</span><span class="op">-</span><span class="va">id</span><span class="op">-</span><span class="va">status</span>,</span>
<span>  time <span class="op">=</span> <span class="va">pbc</span><span class="op">$</span><span class="va">time</span>,</span>
<span>  delta <span class="op">=</span> <span class="va">pbc</span><span class="op">$</span><span class="va">status</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Python is already set up. Skipping `setup_lbcnet()`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating propensity scores for ck/h calculation...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>⚠️ LSD stopping criterion not met by max_epochs. Consider increasing `max_epochs` or adjusting `lsd_threshold`.
Starting post-processing: computing treatment effect and variance...
✅ LBC-Net survival estimation completed successfully.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_surv</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
 trt ~ . - time - id - status
Sample Size: 276 | Number of Covariates: 16
Treated: 136 | Control: 140

--- Loss ---
Total Loss: 728.9798

--- Local Balance (LSD) % ---
Max LSD:   13.3053
Mean LSD:  2.4379

--- Global Standardized Differences (GSD) % ---
Covariate       Pre-GSD     Post-GSD
--------------------------------------
age             25.8307       2.7128
sexf           -14.3555      -0.2983
ascites          9.3867      -3.5472
hepato         -17.3835       1.8195
spiders          1.8523       2.3435
edema           10.5640       3.7977
bili           -16.2393      -2.4130
chol            -4.3460      -0.6896
albumin        -10.7653       1.5674
copper           5.7695       3.1788
alk.phos         1.8797       1.2826
ast             -8.1487       2.3462
trig            -3.5608       1.7385
platelet        -7.8802      -3.8991
protime        -14.1917      -2.1593
stage          -16.0707      -2.5238

--- Survival Difference Delta(t) = S1(t) - S0(t) ---

Grid of evaluation times:
 time        S1        S0        diff          se      ci_low     ci_high
 3170 0.4182155 0.5074675 -0.08925205 0.004087976 -0.09726449 -0.08123962</code></pre>
</div>
</div>
<p>Below is an example of how to fit a logistic regression model, extract the predicted propensity scores, and compute the GSD using the <code><a href="../reference/gsd.html">gsd()</a></code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">log.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span></span>
<span>  <span class="va">treatment</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span> <span class="va">hispanic</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>  data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ps_log</span> <span class="op">&lt;-</span> <span class="va">log.fit</span><span class="op">$</span><span class="va">fitted.values</span></span>
<span><span class="va">Tr</span> <span class="op">&lt;-</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">treatment</span></span>
<span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="va">lalonde</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"black"</span>, <span class="st">"hispanic"</span>, <span class="st">"married"</span>, <span class="st">"nodegree"</span>, <span class="st">"re74"</span>, <span class="st">"re75"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Compute GSD</span></span>
<span><span class="va">gsd_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gsd.html">gsd</a></span><span class="op">(</span></span>
<span>  Z <span class="op">=</span> <span class="va">Z</span>,</span>
<span>  Tr <span class="op">=</span> <span class="va">Tr</span>,</span>
<span>  ps <span class="op">=</span> <span class="va">ps_log</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gsd_log</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       age  education      black   hispanic    married   nodegree       re74
-14.947443  12.094698  10.175575   1.447039 -19.351822 -11.262428 -25.978241
      re75
-16.354046 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate ATE</span></span>
<span><span class="va">wt_log</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">ps_log</span><span class="op">*</span><span class="va">Tr</span><span class="op">+</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">Tr</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ps_log</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/est_effect.html">est_effect</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">lalonde</span><span class="op">$</span><span class="va">re78</span>, Tr <span class="op">=</span> <span class="va">Tr</span>, wt <span class="op">=</span> <span class="va">wt_log</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 224.6763</code></pre>
</div>
</div>
</section><section class="level2"><h2 id="evaluating-the-estimated-propensity-scores">Evaluating the Estimated Propensity Scores<a class="anchor" aria-label="anchor" href="#evaluating-the-estimated-propensity-scores"></a>
</h2>
<p>After fitting the LBC-Net model and obtaining propensity scores, the next step is to evaluate how well these scores satisfy the key assumptions required for causal inference, such as overlap and covariate balance. This section demonstrates how to use LBC-Net’s diagnostic plots to assess the quality of the estimated scores.</p>
<p>The mirror histogram shows the distribution of propensity scores for treated and control groups. It helps assess the overlap (common support) assumption, which is critical for valid causal comparisons. You can generate this plot directly from the fitted <code>lbc_net</code> object as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mirror_hist.html">mirror_hist</a></span><span class="op">(</span><span class="va">lbc_net.fit</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>While the sample size is relatively small, there is reasonable overlap between groups across much of the propensity score range. In larger datasets, this overlap may be even clearer, but the current plot suggests the assumption is adequately met.</p>
<p>The mirror_hist() function can also be used with any set of propensity scores by specifying ps and Tr. For example, with propensity scores from a logistic regression model <code>mirror_hist(ps = ps_log, Tr = Tr)</code>.</p>
<section class="level3"><h3 id="local-calibration-and-local-balance">Local Calibration and Local Balance<a class="anchor" aria-label="anchor" href="#local-calibration-and-local-balance"></a>
</h3>
<p>After fitting the LBC-Net model, it is important to evaluate whether the estimated propensity scores satisfy key theoretical properties: calibration and covariate balance. These evaluations help assess the quality of the propensity score model and its ability to support valid causal inference.</p>
<p>The local calibration check assesses whether the estimated propensity scores accurately reflect the probability of treatment assignment. We use the <code><a href="../reference/plot_calib.html">plot_calib()</a></code> function to visualize calibration. A well-calibrated model will have its fitted line closely follow the 45-degree line, indicating that predicted probabilities match observed treatment rates across the score range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_calib.html">plot_calib</a></span><span class="op">(</span><span class="va">lbc_net.fit</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this case, due to the small sample size and limited overlap in the Lalonde dataset, we observe some deviation from the 45-degree line, particularly in the middle range of the propensity scores. This suggests that while LBC-Net performs reasonably well, achieving perfect calibration in smaller samples with poor overlap remains challenging.</p>
<p>The local balance check evaluates whether covariates are balanced between treatment groups across the range of propensity scores. We use the <code><a href="../reference/lsd.html">lsd()</a></code> function to calculate the Local Standardized Differences (LSD) and summarize them across covariates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lsd.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lsd.html">lsd</a></span><span class="op">(</span><span class="va">lbc_net.fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lsd.fit</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
 function (x, ...)  UseMethod("formula")
Sample Size: 614  | Number of Covariates: 8
Treated: 185  | Control: 429
Estimand: ATE (Average Treatment Effect)

--- Local Balance (LSD) % ---
Max LSD:   6.5110
Mean LSD:  2.8801

Covariates    LSD %
--------------------
age          4.7450
education    4.0238
black        4.8189
hispanic     2.0604
married      2.3148
nodegree     2.7860
re74         1.4534
re75         0.8387 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lsd.fit</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <code>summary(lsd.fit)</code> function provides the mean LSD for each covariate, while <code>plot(lsd.fit)</code> visualizes local balance across the entire score range. The default plot shows boxplots summarizing the variation in local balance across all covariates (cov = “all”). To focus on a specific covariate, such as age, you can specify it directly with <code>cov = "age"</code>. If you prefer to remove the boxplots and focus on the local balance curves, you can suppress them by setting <code>box.loc = NULL</code>. In this example, LBC-Net maintains local standardized differences generally under <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>5</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">5\%</annotation></semantics></math> across the full range of propensity scores, suggesting good local balance.</p>
<p>For comparison, we can evaluate the local balance and calibration of propensity scores estimated from a traditional logistic regression model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_calib.html">plot_calib</a></span><span class="op">(</span>Tr <span class="op">=</span> <span class="va">Tr</span>, ps <span class="op">=</span> <span class="va">ps_log</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lsd.fit.log</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lsd.html">lsd</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="va">Z</span>, Tr <span class="op">=</span> <span class="va">Tr</span>, ps <span class="op">=</span> <span class="va">ps_log</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">lsd.fit.log</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
 function (x, ...)  UseMethod("formula")
Sample Size: 614  | Number of Covariates: 8
Treated: 185  | Control: 429
Estimand: ATE (Average Treatment Effect)

--- Local Balance (LSD) % ---
Max LSD:   77.7346
Mean LSD:  10.2577

Covariates    LSD %
--------------------
age         16.3696
education    9.0942
black        6.0572
hispanic     2.9699
married     13.7013
nodegree    12.7773
re74        11.7533
re75         9.3384 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">lsd.fit.log</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-14-2.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Compared to LBC-Net, logistic regression shows larger global and local imbalance, with higher LSD values and more severe deviations in the calibration plot. These results highlight the advantage of LBC-Net in achieving better local balance and calibration, particularly in datasets with challenging overlap and sample size conditions.</p>
</section></section><section class="level2"><h2 id="chat-balance-covariate-distribution">Chat: Balance Covariate Distribution<a class="anchor" aria-label="anchor" href="#chat-balance-covariate-distribution"></a>
</h2>
<p>The <code><a href="../reference/plot_cov_bal.html">plot_cov_bal()</a></code> function shows the distribution of a specific covariate in the treated and control groups, both before and after weighting. This allows you to visually assess whether LBC-Net has improved covariate balance after applying weights. In this example, we examine the balance of the covariate <code>age</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cov_bal.html">plot_cov_bal</a></span><span class="op">(</span><span class="va">lbc_net.fit</span>, cov <span class="op">=</span> <span class="st">"age"</span>, use_weights <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By default, the plot displays the weighted distribution using kernel density estimation. If you prefer to view the unweighted distribution, you can set <code>use_weights = FALSE</code>. Additionally, you can display the distribution as histograms instead of density plots by using <code>plot_type = "hist"</code>. For categorical variables, the function will automatically display histograms. In most cases, binary variables are well balanced after weighting. However, for categorical variables with more than two levels, you should create dummy (one-hot encoded) variables before fitting the model to ensure proper balance across categories.</p>
<p>As shown in the plot, the method is designed to balance the first moment (mean) of covariates. However, it may not fully balance the entire distribution, particularly for continuous variables such as age. To address this, one option is to categorize continuous variables and treat them as categorical in the model. This can improve balance across the categories, rather than just matching the means. Below, we categorize age into 3 groups and education into 4 groups. We then create dummy variables for these categories and fit the LBC-Net model using the newly processed data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Categorize age (3 groups) and education (4 groups)</span></span>
<span><span class="va">lalonde</span><span class="op">$</span><span class="va">age_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">age</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">23</span>, <span class="fl">30</span>, <span class="fl">37</span>, <span class="fl">44</span>, <span class="fl">55</span><span class="op">)</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">lalonde</span><span class="op">$</span><span class="va">education_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">$</span><span class="va">education</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">12</span>, <span class="fl">16</span>, <span class="fl">18</span><span class="op">)</span>, include.lowest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create dummy variables</span></span>
<span><span class="va">age_dummies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">age_group</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span>
<span><span class="va">education_dummies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">education_group</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Clean names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">age_dummies</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/make_clean_names.html" class="external-link">make_clean_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">age_dummies</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">education_dummies</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/make_clean_names.html" class="external-link">make_clean_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">education_dummies</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Combine data</span></span>
<span><span class="va">lalonde_processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">lalonde</span><span class="op">[</span>, <span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"age_group"</span>, <span class="st">"education_group"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">age_dummies</span>,</span>
<span>  <span class="va">education_dummies</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lalonde_processed</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://sfirke.github.io/janitor/reference/make_clean_names.html" class="external-link">make_clean_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">lalonde_processed</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit LBC-Net model</span></span>
<span><span class="va">lbc_net.fit.new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbc_net.html">lbc_net</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">lalonde_processed</span>,</span>
<span>  formula <span class="op">=</span> <span class="va">treatment</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">re78</span>,</span>
<span>  max_epochs <span class="op">=</span> <span class="fl">15000</span>,</span>
<span>  rho <span class="op">=</span> <span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>⚠️ Stopping criterion not met at max epochs. Try increasing `max_epochs` or adjusting `lsd_threshold` for better convergence.
✅ LBC-Net training completed successfully.</code></pre>
</div>
</div>
<p>After fitting the new model, you can review the updated balance summaries and compare the covariate distributions across methods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cov_bal.html">plot_cov_bal</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="va">Z</span>, Tr <span class="op">=</span> <span class="va">Tr</span>, wt <span class="op">=</span> <span class="va">lbc_net.fit.new</span><span class="op">$</span><span class="va">weights</span>, cov <span class="op">=</span> <span class="st">"age"</span>, use_weights <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cov_bal.html">plot_cov_bal</a></span><span class="op">(</span>Z <span class="op">=</span> <span class="va">Z</span>, Tr <span class="op">=</span> <span class="va">Tr</span>, wt <span class="op">=</span> <span class="va">wt_log</span>, cov <span class="op">=</span> <span class="st">"age"</span>, use_weights <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="tutorial_files/figure-html/unnamed-chunk-17-2.png" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h2 id="reference">Reference<a class="anchor" aria-label="anchor" href="#reference"></a>
</h2>
<p>Rosenbaum, P. R. and Rubin, D. B. (1983). The central role of the propensity score in observational studies for causal effects. Biometrika, 70(1):41–55.</p>
<p>Zubizarreta J, Li Y, Kim K (2024). sbw: Stable Balancing Weights for Causal Inference and Missing Data. R package version 1.1.9, https://CRAN.R-project.org/package=sbw.</p>
</section><section class="level2"><h2 id="contribute-and-feedback">Contribute and Feedback<a class="anchor" aria-label="anchor" href="#contribute-and-feedback"></a>
</h2>
<p>We welcome contributions, feedback, and suggestions!<br>
- Report bugs or request features on our <a href="https://github.com/MaosenPeng1/LBCNet_web/issues" class="external-link">GitHub Issues page</a>.<br>
- Fork the repository and submit pull requests to help improve LBCNet!</p>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maosen Peng, Yan Li, Chong Wu, Liang Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
